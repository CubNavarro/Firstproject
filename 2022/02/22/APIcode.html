<p>from flask import Blueprint, request, jsonify
from flask_restful import Api, Resource # used for REST API building
from datetime import datetime</p>

<p>from model.users import User</p>

<h1 id="blueprint-which-is-registered-to-app-in-mainpy">blueprint, which is registered to app in main.py</h1>
<p>user_api = Blueprint(‘user_api’, <strong>name</strong>,
                   url_prefix=’/api/users’)</p>

<h1 id="api-docs-httpsflask-restfulreadthedocsioenlatestapihtmlid1">API docs https://flask-restful.readthedocs.io/en/latest/api.html#id1</h1>
<p>api = Api(user_api)
class UserAPI:      <br />
    class _Create(Resource):
        def post(self):
            ‘’’ Read data for json body ‘’’
            body = request.get_json()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        ''' Avoid garbage in, error checking '''
        # validate name
        name = body.get('name')
        if name is None or len(name) &lt; 2:
            return {'message': f'Name is missing, or is less than 2 characters'}, 210
        # validate uid
        uid = body.get('uid')
        if uid is None or len(uid) &lt; 2:
            return {'message': f'User ID is missing, or is less than 2 characters'}, 210
        # look for password and dob
        password = body.get('password')
        dob = body.get('dob')

        ''' #1: Key code block, setup USER OBJECT '''
        uo = User(name=name, 
                  uid=uid)
        
        ''' Additional garbage error checking '''
        # set password if provided
        if password is not None:
            uo.set_password(password)
        # convert to date type
        if dob is not None:
            try:
                uo.dob = datetime.strptime(dob, '%m-%d-%Y').date()
            except:
                return {'message': f'Date of birth format error {dob}, must be mm-dd-yyyy'}, 210
        
        ''' #2: Key Code block to add user to database '''
        # create user in database
        user = uo.create()
        # success returns json of user
        if user:
            return jsonify(user.read())
        # failure returns error
        return {'message': f'Processed {name}, either a format error or User ID {uid} is duplicate'}, 210

class _Read(Resource):
    def get(self):
        users = User.query.all()    # read/extract all users from database
        json_ready = [user.read() for user in users]  # prepare output in json
        return jsonify(json_ready)  # jsonify creates Flask response object, more specific to APIs than json.dumps

# building RESTapi endpoint
api.add_resource(_Create, '/create')
api.add_resource(_Read, '/')
</code></pre></div></div>
